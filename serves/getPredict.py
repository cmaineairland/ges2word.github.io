'''
Date: 2024-05-27 14:45:11
LastEditors: Qianshanju
E-mail: z1939784351@gmail.com
LastEditTime: 2024-05-30 20:46:48
FilePath: \gesrec\serves\getPredict.py
'''
import torch
import json
import os


def getJsonData(selectedModel):

    json_file = os.path.join(
        os.path.dirname(os.path.dirname(os.path.abspath(__file__))),
        'model/20240527240527001001', 'dictionary.json')

    with open(json_file, 'r', encoding='utf-8') as f:  # 打开JSON文件
        json_data = json.load(f)  # 读取JSON数据
    return json_data['dic']


def get_predict(inputs, selectedModel):
    class_dict = getJsonData(selectedModel)
    net_path = 'model/20240527240527001001/netWork.pth'
    # 加载模型
    model = torch.load(net_path)
    model.eval()
    outputs = model(torch.Tensor(inputs).to(torch.float32))
    _, preds = torch.max(outputs, 0)
    return class_dict[preds.item()]


if __name__ == '__main__':
    inputs = [
        1, 0.5849553942680359, 0.9196765422821045, -6.151653906272259e-07,
        0.659277081489563, 0.881123423576355, -0.04280130937695503,
        0.7302631139755249, 0.8069460391998291, -0.05513555184006691,
        0.7542697191238403, 0.7368911504745483, -0.06600479781627655,
        0.7667872309684753, 0.6785576343536377, -0.07178311049938202,
        0.6398127675056458, 0.7285019159317017, -0.017795948311686516,
        0.6137900948524475, 0.6901546120643616, -0.059865523129701614,
        0.6065952777862549, 0.7462518811225891, -0.08132248371839523,
        0.6112250089645386, 0.8019384741783142, -0.08279541879892349,
        0.5815542936325073, 0.7370771765708923, -0.009420420043170452,
        0.5636172294616699, 0.6969678997993469, -0.06376419216394424,
        0.5613369345664978, 0.7695913910865784, -0.08328570425510406,
        0.5688032507896423, 0.8301716446876526, -0.07857897877693176,
        0.5321489572525024, 0.7511798143386841, -0.008974173106253147,
        0.5105890035629272, 0.72026127576828, -0.060680538415908813,
        0.5166084170341492, 0.784690260887146, -0.06741338968276978,
        0.5326851606369019, 0.8384014368057251, -0.05170026421546936,
        0.4892648160457611, 0.7706956267356873, -0.011551032774150372,
        0.46604812145233154, 0.7088419795036316, -0.03584500774741173,
        0.44368991255760193, 0.6767418384552002, -0.03890358284115791,
        0.42612385749816895, 0.6494215726852417, -0.031001262366771698
    ]
    get_predict(inputs, '1')
